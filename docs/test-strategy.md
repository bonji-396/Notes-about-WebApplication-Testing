# テスト戦略（Test Strategy）

テスト戦略とは、プロジェクト全体で「どのようにテストを実施するか」を定める 基本方針・計画 のことです。
目的は、品質を保証しつつ、コスト・納期・リスクのバランスを取ることにあります。

ソフトウェア開発において効果的なテスト戦略は、プロジェクトの品質保証の基盤となります。


## テスト戦略で配慮するべき項目
|項|内容|
|---|---|
|テストの目的と範囲|何をテスト対象とし、どこまでを品質保証の対象とするか|
|テストレベル・種類|単体、結合、E2E、UAT、非機能テスト（性能・セキュリティ・アクセシビリティ）など|
|テスト設計方針|どういった観点・技法でテストケースを設計するか（等価クラステスト、境界値分析など）|
|自動化方針|どのテストを自動化するか、ツール選定、CI/CDとの連携など|
|テスト環境|本番相当の環境をどう構築・維持するか|
|テストデータ戦略|データの準備、匿名化、再利用など|
|欠陥管理・レポート|バグの報告、分類、トラッキングの方法|
|担当者・責任分担|誰がどのフェーズで何を行うか|


## プロジェクトによる異なる戦略

テスト戦略は「プロジェクトの規模、目的、開発体制、ドメインの特性」によって最適解が異なります。プロジェクトの規模や状況の応じて、最適なテスト実施と方向性を決める必要があります。

### 例:
- 医療・金融など高リスク領域: → 非機能テストを重視
- スタートアップ: → MVP重視でUATとE2Eに重点
- OSSやWebアプリ: → テスト自動化とアクセシビリティが重要

## テストピラミッド（Test Pyramid）

テストピラミッドは、Mike Cohn氏が提唱した考え方で、コスト効率の良いテスト構成を示しています。

![Test Pyramid](./test-pyramid.svg)

下に行くほどテスト数が多く、高速・安定・自動化しやすい。  
上の層は「ユーザー視点の動作確認」だが、重く・壊れやすいため最小限する。

### ポイント
- 実行速度が速く低コストな単体テストを多く
- 実行に時間がかかり複雑なE2Eテストは重要な機能に絞る
- コスト対効果のバランスを取る

|ピラミット構造|テスト種別|テストの量|コスト|実行速度|
|---|---|---|---|---|
|頂点|UI/E2Eテスト|少数|高|遅|
|中間|統合テスト|中程度|中|中|
|底辺|単体テスト|多数|低|速|



## テスティング・トロフィー（Testing Trophy）

Kent C. Dodds氏が提唱したテスト戦略のモデルで、静的解析や型チェックの重要性を強調しています。現在のフロントエンド開発向けに発展させた考え方で、テストピラミッドよりも “Integration Test” を重視する 点が特徴です。


![Testing Trophy](testting-tropy.svg)

### ポイント
静的解析が土台として追加されています。TypeScript、ESLint、Prettier、Flowなど、コードを実行せずに問題を検出することが狙いで。タイプミス、肩の不一致、フォーマットの問題を事前に発券し、CIパイプラインにも組み込みやすいのが特徴です。

また、結合テストが最も重要視される点が、テストピラミッドと異なります。

|ピラミット構造|テスト種別|テストの量|コスト|実行速度|
|---|---|---|---|---|
|頂点|UI/E2Eテスト|少数|高|遅|
|中間１層|統合テスト|中程度|中|中|
|中間２層|単体テスト|多数|低|速|
|底辺|静的解析|多数|低|速|


##  現実的な戦略構築ステップ

1. 品質要求とリスク評価
   - 「どこが壊れると困るか？」「性能要件は？」「障害者対応は？」
2. 各レイヤーに必要なテスト種類と範囲の明確化
   - フロントエンド：ユニット、スナップショット、E2E、アクセシビリティ
   - バックエンド：ユニット、結合、負荷、セキュリティ、API契約テスト
3. 自動化 vs 手動の切り分け
   - 頻繁に実行する・壊れやすい → 自動化
   - 重要だが難易度が高い → 手動（UATなど）
4. CI/CD との統合
   - PR時にユニットテストやLinter実行
   - デプロイ前にE2Eテスト・アクセシビリティテストなど実施


## よく使われるツール例

|分類|ツール例|
|---|---|
|ユニット|Jest, Vitest, Jasmine|
|結合/API|Supertest, StepCI, Pact|
|E2E|Cypress, Playwright|
|静的解析|ESLint, TypeScript, SonarQube|
|アクセシビリティ|axe-core, Lighthouse|
|パフォーマンス|JMeter, k6, Locust|
